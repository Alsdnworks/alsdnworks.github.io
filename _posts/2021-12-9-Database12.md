---
title: 데이터베이스 제 12강[KNU 2021-2]
categories:
  - KNU
tags:
  - SQL
  - INJECTION
toc: true
---

# 👨‍💻🏫KNU 2021-2 SW & media 데이터베이스 필기노트 12


## 1. 트랜잭션

하나의 작업을 수행하는데에 필요한 연산을 모아두는것으로 데이터베이스 변경연산 수행을 관리한다.<br>
논리적인 작업의 단위로 복구와 병행작업에서 트랜잭션을 실행 단위로 사용한다.

### 1.1. 트랜잭션 특성 

트랜잭션의 특성은 ACID(Atomicity, Consistency, Isolation, Durability)로 불린다.

원자성

- 데이터베이스에서 수행된 연산이 모두 정상적으로 완료되거나 아예 실행이 되어서는 안되야하는 방식을 의미한다.
- 트랜잭션 수행중 오류발생시 작업 전으로 돌려보내야한다.
- 회복기능과 관련

일관성

- 트랜잭션 수행후 데이터베이스는 일관된 상테를 유지해야함을 의미한다.
- 병행제어기능과 관련

격리성

- 수행 중인 트랜잭션이 완료될때까지 다른 트랜잭션이 개입할수 없다.
- 병행제어기능과 관련

지속성

- 트랜젝션수행후 데이터베이스에 반영한 수행 결과는 영구적이여야한다.
- 회복기능과 관련

### 1.2. 트랜잭션 연산과 상태

`commit` 트랜잭션 수행 성공, 작업완료선언<br>
`rollback` 트랜잭션 수행 실패, 실패선언

|상태|설명|
|-|-|
|활동|트랜잭션 수행중|
|부분완료|트랜잭션 연산 종료|
|완료|수행결과를 데이터베이스에 반영후 commit연산을 끝낸상태|
|실패|장애 발생으로 트랜잭션 수행이 중단된 상태|
|철회|실패로인해 rollback이 수행된 상태|

**트랜잭션 수행 상태도**

| | | | | 
|-|-|-|-|
| | |실패->|철회(rollback)| 
|활동->|부분완료->| | | 
| | |완료(commit)| | 

## 2. 장애와 회복

### 2.1. 장애

|유형|설명|
|-|-|
|트랜잭션장애|트랜잭션수행중 오류가 발생 <br>발생원인 트랜잭션 논리오류, 데이터 오류, 시스템자원 과다사용, 처리대상의 부재|
|시스템장애|하드웨어결함(메인 메모리)|
|미디어장애|기록 매체(미디어)결함|

|응용프로그램|  |메인 메모리|  |디스크|
|-|-|-|-|-|
|A|<-read|A|<-input|A|
|B|->write|B|->output|B|

디스크와 메인 메모리간의 데이터 이동은 블록단위로 수행된다. 메인 메모리는 버퍼블록, 디스크는 디스크블록단위로 수행된다.

응용 프로그램에서는 트랜잭션 수행시 메인 메모리 버퍼의 값을 가져오며 처리결과의 변수값을 메인 메모리에 저장하는 과정을 수행한다.

### 2.2. 회복

데이터베이스 회복의 핵심원리는 데이터 중복을 통해 이루어진다. 

- 덤프: 데이터베이스 전체를 다른 장치에 주기적으로 복사
- 로그: 데이터베이스 트랜잭션 수행시 변경값과 변경후 값을 별도 파일에 기록 로그파일은 레코드 단위로 트랜잭션 수행과 함께 저장된다.
<br><br>

- redo:  가장 최근 저장된 데이터베이스 복사본을 통해 로그를 사용하여 복사본 이후 실행된 연산을 재실행되어 장애 전 데이터베이스 상태로 복구한다.
- undo : 로그를 사용해 시행된 모든 변경 연산을 취소하여 원래 상태로 복구한다.

**DB회복기법**

- 로그회복기법: 즉시 갱신 회복 기법, 지연 갱신 회복 기법
- 검사 시점 회복 기법
- 미디어 회복 기법

즉시회복기법: 트랜잭션 수행 중에 변경 연산의 결과를 데이터베이스에 즉시 반영, 데이터 변경 내용을 로그파일에 기록, 장애 발생 시점에따라 redo, undo연산 실행<br>
지연 갱신 회복 기법: 트랜잭션 수행중 변경 연산의 결과를 로그파일에만 기록한다. 부분 완료후 데이터베이스에 반영한다. undo연산이 필요없다.<br>
검사 시점 회복 기법: 로그 기록을 사용해 일정간견으로 검사 시점을 만든다. 장애 발생시 최신 검사시점이후 트랜잭션에만 회복 작업 수행<br>
미디어 회복 기법: 덤프사용, 일정 주기마다 다른 매체에 덤프를 생성, 최신 덤프를 사용해 복구하며 필요시 redo연산 수행<br>